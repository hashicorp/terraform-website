---
page_title: Operational Modes - Terraform Enterprise
description: >-
  Learn about the different operational modes of Terraform Enterprise.
---

# Terraform Enterprise Operational Modes

Before deploying Terraform Enterprise, you must choose an operational mode.
Each operational mode changes where Terraform Enterprise stores its data.

## Terraform Enterprise Data

Terraform Enterprise data utilizes the following types of data:

- **PostgreSQL Database** - Stateful Terraform Enterprise application data. (e.g. workspace settings, organization settings, run information, user information)

- **Object Storage** - Artifacts generated by Terraform Enterprise. (e.g. state files, plan files, run logs, configuration versions)

- **Vault** - Encryption keys used to encrypt and decrypt objects within object storage.

- **Configuration** - Configuration settings. (e.g. the hostname, object storage credentials, database credentials, concurrency settings, etc.)

## Operational Modes

The following table lists each operational mode and where it stores each type of data.

| Operational Mode                        | PostgreSQL Database                                                              | Object Storage                                                                  | Vault                                                                             | Configuration                              |
| --------------------------------------- | -------------------------------------------------------------------------------- | ------------------------------------------------------------------------------- | --------------------------------------------------------------------------------- | ------------------------------------------ |
| [Mounted Disk](#mounted-disk)           | Stored in a directory on the instance backed by user-managed persistent storage. | Stored in a directory on the instance backed by user-managed persisent storage. | Stored in the PostgreSQL Database unless using [External Vault](#external-vault). | Stored in a Docker volume on the instance. |
| [External Services](#external-services) | Stored in an external user-managed PostgreSQL database.                          | Stored in an external user-managed object storage location.                     | Stored in the PostgreSQL Database unless using [External Vault](#external-vault). | Stored in a Docker volume on the instance. |

## Mounted Disk

The Mounted Disk operational mode stores the PostgreSQL Database and Object Storage data in a directory on the instance. It is expected that this directory is backed by persistent storage that can be mounted to the instance. This allows you to backup and restore the PostgreSQL Database or Object Storage data independently of the Terraform Enterprise instance.

You are responsible for providing and maintaining the persistent storage.

Configuration data is stored on a Docker volume on the instance. You can retrieve this information using `replicatedctl app-config export`.

### When to Use Mounted Disk

Mounted Disk is recommended when:

- Running Terraform Enterprise in an environment that does not have an external PostgreSQL server or S3-compatible object storage.
- You have experience managing persistent storage such as an AWS EBS volume, an Azure Managed Disk, a Google Cloud Persistent Disk, an iSCSI location, etc.
- Are familiar with using tools like `cp`, `scp`, and `rsync` to backup and restore data.

## External Services

The External Services operational mode stores the PostgreSQL Database and Object Storage data on an external PostgreSQL server and S3-compatible object storage. This allows you to backup, restore, and scale the PostgreSQL Database or Object Storage independently of the Terraform Enterprise instance.

You are responsible for providing and maintaining the external PostgreSQL server and S3-compatible object storage.

Configuration data is stored on a Docker volume on the instance. You can retrieve this information using `replicatedctl app-config export`.

### When to Use External Services

External Services is recommended when:

- Running Terraform Enterprise in environment that has an external PostgreSQL server or S3-compatible object storage.
- You have experience managing a PostgreSQL server such as Amazon RDS for PostgreSQL, Google Cloud SQL for PostgreSQL, Azure Database for PostgreSQL, etc.
- You have experience managing an S3-compatible object storage location such as AWS S3, Azure Blob Storage, Google Cloud Storage, MinIO, etc.
- Want to use native backup and restore features provided by the external PostgreSQL server and S3-compatible object storage.

## External Vault

Terraform Enterprise automatically creates an internally-managed Vault server that stores its data in the PostgreSQL Database. We strongly recommend that organizations use this internally-managed Vault server. However, some organizations have specific requirements around data encryption and auditing. Those organizations can configure Terraform Enterprise to use an external Vault server rather than the internally-managed Vault server.

!> **Warning:** When using external Vault, you assume full responsibility for the Vault server. That includes sealing, unsealing, replication, etc. Do not use external Vault unless you have experience managing Vault in production.

!> **Warning:** Multiple Terraform Enterprise instances cannot use the same external Vault server unless they are a part of an Active/Active installation. Doing so will result in data loss.

~> **Important:** External Vault must be configured during initial installation and can only be changed using the [backup and restore API](/enterprise/admin/infrastructure/backup-restore).

### External Vault Configuration

Run the following commands to configure your external Vault server for use with Terraform Enterprise.

1. Enable the AppRole Auth Method.

  ```sh
  vault auth enable approle
  ```

1. Enable the Transit Secrets Engine.

  ```sh
  vault secrets enable transit
  ```

1. Create the `tfe-policy.hcl` file with the following content:

  ```hcl
  path "auth/approle/login" {
    capabilities = ["create", "read"]
  }

  path "sys/renew/*" {
    policy = "write"
  }

  path "auth/token/renew/*" {
    policy = "write"
  }

  path "transit/encrypt/atlas_*" {
    capabilities = ["create", "update"]
  }

  path "transit/decrypt/atlas_*" {
    capabilities = ["update"]
  }

  path "transit/encrypt/archivist_*" {
    capabilities = ["create", "update"]
  }

  # For decrypting datakey ciphertexts.
  path "transit/decrypt/archivist_*" {
    capabilities = ["update"]
  }

  # To upsert the transit key used for datakey generation.
  path "transit/keys/archivist_*" {
    capabilities = ["create", "update"]
  }

  # For performing key derivation.
  path "transit/datakey/plaintext/archivist_*" {
    capabilities = ["update"]
  }

  # For health checks to read the mount table.
  path "sys/mounts" {
    capabilities = ["read"]
  }
  ```

1. Create the `tfe` policy using the `tfe-policy.hcl` policy content.

  ```sh
  vault policy write tfe tfe-policy.hcl
  ```

1. Create an AppRole with a periodic token using the `tfe` policy.

  ```sh
  vault write auth/approle/role/tfe policies="tfe" token_period=24h
  ```

1. Fetch the RoleID of the AppRole. This maps back to the `extern_vault_role_id` Terraform Enterprise configuration setting.

  ```sh
  vault read auth/approle/role/tfe/role-id
  ```

1. Fetch the SecretID of the AppRole. This maps back to the `extern_vault_secret_id` Terraform Enterprise configuration setting.

  ```sh
  vault write -f auth/approle/role/tfe/secret-id
  ```
