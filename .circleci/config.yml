version: 2

jobs:
  algolia-index:
    docker:
      - image: node:14
    steps:
      - checkout
      - run:
          name: Pull submodules
          command: git submodule update --init
      - run:
          name: Push content to Algolia Index
          command: |
            if  [ "$CIRCLE_REPOSITORY_URL" != "git@github.com:hashicorp/terraform-website.git" ]; then
              echo "Not Terraform Website Repo, not indexing Algolia"
              exit 0
            fi
            npm i -g npm@latest
            npm ci
            node scripts/index_search_content.js
workflows:
  version: 2
  algolia_index:
    jobs:
      - algolia-index:
          filters:
            branches:
              only:
                - master
